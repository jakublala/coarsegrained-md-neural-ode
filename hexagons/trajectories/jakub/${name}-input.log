
# Simulation Parameters
variable log_freq equal 10000                   # log frequency
variable runsteps equal 1000000               # N of steps to run for
variable timestep equal 0.00001                 # timestep

# -------------------------- ATOMS/MOLECULE DEFINITION --------------------------
read_data hex.conf                              # Add a hexagon molecule
  orthogonal box = (-25 -25 -25) to (25 25 25)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  7 atoms
  scanning bonds ...
  6 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  12 bonds
  reading angles ...
  11 angles
  6 = max # of 1-2 neighbors
  12 = max # of 1-3 neighbors
  36 = max # of 1-4 neighbors
  6 = max # of special neighbors
read_data hex.conf add append shift 4.0 0.0 0.0 # Add a second identical molecule, shifted so it doesn't overlap
  orthogonal box = (-25 -25 -25) to (29 25 25)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  7 atoms
  scanning bonds ...
  6 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  12 bonds
  reading angles ...
  11 angles
  6 = max # of 1-2 neighbors
  12 = max # of 1-3 neighbors
  36 = max # of 1-4 neighbors
  6 = max # of special neighbors

# Group ID can be used in other commands, including fix, compute, dump or velocity
group       hex_1 id 1 2 3 4 5 6 7              # label the atoms 1-7 as a group
7 atoms in group hex_1
group       hex_2 id 8 9 10 11 12 13 14         # label the atoms 8-14 as another group
7 atoms in group hex_2

# -------------------------- INTERATOMIC POTENTIALS -----------------------------
# Pairwise potentials
pair_style  lj/cut  ${cut}                      # lj truncated - cutoff at 1.12 sigma
pair_style  lj/cut  1.12246                      
pair_coeff  *   *   1.0 ${sigma}                # epsilon | sigma - * * means all atoms interact with each other
pair_coeff  *   *   1.0 1                
fix hex_spring_NVT hex_1 spring couple hex_2 1.0 0.0 0.0 0.0 ${r0} # adds harmonic spring between rigid bodies
fix hex_spring_NVT hex_1 spring couple hex_2 1.0 0.0 0.0 0.0 2 
                            # f_hex_spring[1,2,3,4] = force_x, force_y, force_z, magnitude of the force


################## SYSTEM INITIALISATION WITH AN NVT SIMULATION ##################
# -------------------------------------------------------------------------------
# Add energy to the system by running an NVT simulation, use a very stiff spring to
# keep rigid bodies close. Then, remove (unfix) the thermostat and spring before
# initialising and running the more important NVE simulation
# -------------------------------------------------------------------------------

# System fixes: spring and nose-hoover thermostat
fix hex_spring_NVT hex_1 spring couple hex_2 1 0 0 0 ${r0} # adds harmonic spring between RBs
fix hex_spring_NVT hex_1 spring couple hex_2 1 0 0 0 2 
fix rigid_1_NVT hex_1 rigid/nvt/small molecule temp ${temp} ${temp} 1.0 tparam 10 3 3
fix rigid_1_NVT hex_1 rigid/nvt/small molecule temp 2.25 ${temp} 1.0 tparam 10 3 3
fix rigid_1_NVT hex_1 rigid/nvt/small molecule temp 2.25 2.25 1.0 tparam 10 3 3
1 rigid bodies with 7 atoms
  1 = max distance from body owner to body atom
fix rigid_2_NVT hex_2 rigid/nvt/small molecule temp ${temp} ${temp} 1.0 tparam 10 3 3
fix rigid_2_NVT hex_2 rigid/nvt/small molecule temp 2.25 ${temp} 1.0 tparam 10 3 3
fix rigid_2_NVT hex_2 rigid/nvt/small molecule temp 2.25 2.25 1.0 tparam 10 3 3
1 rigid bodies with 7 atoms
  1 = max distance from body owner to body atom

# Basic output to terminal
thermo ${log_freq}
thermo 10000
thermo_style custom step f_hex_spring_NVT[*] temp pe ke etotal

# Set temperature and run simulation
velocity hex_1 create ${temp} ${seed}
velocity hex_1 create 2.25 ${seed}
velocity hex_1 create 2.25 5
WARNING: Cannot count rigid body degrees-of-freedom before bodies are fully initialized (../fix_rigid_small.cpp:1005)
WARNING: Cannot count rigid body degrees-of-freedom before bodies are fully initialized (../fix_rigid_small.cpp:1005)
run 0
Neighbor list info ...
  1 neighbor list requests
  update every 1 steps, delay 10 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 1.42246
  ghost atom cutoff = 1.42246
  binsize = 0.71123 -> bins = 76 71 71
Memory usage per processor = 18.8066 Mbytes
Step f_hex_spring_NVT[1] f_hex_spring_NVT[2] f_hex_spring_NVT[3] f_hex_spring_NVT[4] Temp PotEng KinEng TotEng 
       0   0.14285714            0            0   0.14285714  0.052674303            0  0.016931026  0.016931026 
Loop time of 2.84053e-06 on 1 procs for 0 steps with 14 atoms

70.4% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0          | 0          | 0          |   0.0 |  0.00
Bond    | 0          | 0          | 0          |   0.0 |  0.00
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0          | 0          | 0          |   0.0 |  0.00
Output  | 0          | 0          | 0          |   0.0 |  0.00
Modify  | 0          | 0          | 0          |   0.0 |  0.00
Other   |            | 2.841e-06  |            |       |100.00

Nlocal:    14 ave 14 max 14 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:    0 ave 0 max 0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    0 ave 0 max 0 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 0
Ave neighs/atom = 0
Ave special neighs/atom = 6
Neighbor list builds = 0
Dangerous builds = 0
velocity all scale ${temp}
velocity all scale 2.25
run 100000
Memory usage per processor = 18.8066 Mbytes
Step f_hex_spring_NVT[1] f_hex_spring_NVT[2] f_hex_spring_NVT[3] f_hex_spring_NVT[4] Temp PotEng KinEng TotEng 
       0   0.14285714            0            0   0.14285714  0.052674303            0  0.016931026  0.016931026 
   10000   0.20041323   0.19780406 -0.0053086966   0.28163823    1.4657754            0   0.47114211   0.47114211 
   20000   0.15941521   0.19903808  -0.17471163   0.30911733    5.0011035            0    1.6074976    1.6074976 
   30000 -0.053853595 -0.078471635 -0.015699386  0.096459722    6.7535216            0    2.1707748    2.1707748 
   40000  0.063452108  0.067153412  0.090170706   0.12909883    3.3876197            0    1.0888778    1.0888778 
   50000   0.11817554  0.036186313   0.16670075   0.20751879    4.3709525            0     1.404949     1.404949 
   60000 -0.042047824  0.030835314 -0.030714679  0.060516342     3.160887 -0.070203802    1.0159994   0.94579559 
   70000 0.0063090502 -0.088899804 0.0076618017  0.089452124    1.3275844            0   0.42672356   0.42672356 
   80000  0.034711592 0.0010156257  0.041913523  0.054430409    1.1701147            0    0.3761083    0.3761083 
   90000   0.10144775  0.045349883    0.1252861   0.16746601    3.6387472            0    1.1695973    1.1695973 
  100000 -0.039292852  -0.23712379 -0.026699583   0.24183566    1.7167143            0   0.55180103   0.55180103 
Loop time of 2.19462 on 1 procs for 100000 steps with 14 atoms

Performance: 19684461.492 tau/day, 45565.883 timesteps/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.0095645  | 0.0095645  | 0.0095645  |   0.0 |  0.44
Bond    | 0.0032869  | 0.0032869  | 0.0032869  |   0.0 |  0.15
Neigh   | 1.1332     | 1.1332     | 1.1332     |   0.0 | 51.64
Comm    | 0.050188   | 0.050188   | 0.050188   |   0.0 |  2.29
Output  | 0.000164   | 0.000164   | 0.000164   |   0.0 |  0.01
Modify  | 0.97629    | 0.97629    | 0.97629    |   0.0 | 44.49
Other   |            | 0.02189    |            |       |  1.00

Nlocal:    14 ave 14 max 14 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:    7 ave 7 max 7 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    0 ave 0 max 0 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 0
Ave neighs/atom = 0
Ave special neighs/atom = 6
Neighbor list builds = 6989
Dangerous builds = 773

unfix rigid_1_NVT
unfix rigid_2_NVT
unfix hex_spring_NVT

################################ NVE SIMULATION #################################
# ------------------------------- SYSTEM FIXES ----------------------------------
fix rig_hex_1 hex_1 rigid/nve/small molecule
1 rigid bodies with 7 atoms
  1 = max distance from body owner to body atom
fix rig_hex_2 hex_2 rigid/nve/small molecule
1 rigid bodies with 7 atoms
  1 = max distance from body owner to body atom
fix hex_spring hex_1 spring couple hex_2 ${K} 0.0 0.0 0.0 ${r0} # spring between RBs
fix hex_spring hex_1 spring couple hex_2 17.8583270116258 0.0 0.0 0.0 ${r0} 
fix hex_spring hex_1 spring couple hex_2 17.8583270116258 0.0 0.0 0.0 2 
# f_hex_spring[1,2,3,4] = force_x, force_y, force_z, magnitude of the force

# ----------------------------- PROPERTY COMPUTES -------------------------------
# Calculate rigid body properties - local data, so must be outputted using dump ... "local"
compute com_1   all rigid/local rig_hex_1 xu yu zu                  # RB1 unscaled center of mass x, y, z
compute com_2   all rigid/local rig_hex_2 xu yu zu                  # RB2 unscaled center of mass x, y, z
compute vel_1   all rigid/local rig_hex_1 vx vy vz                  # RB1 center of mass velocities vx, vy, vz
compute vel_2   all rigid/local rig_hex_2 vx vy vz                  # RB2 center of mass velocities vx, vy, vz
compute q_1     all rigid/local rig_hex_1 quati quatj quatk quatw   # RB1 quaternion components
compute q_2     all rigid/local rig_hex_2 quati quatj quatk quatw   # RB2 quaternion components
compute av_1    all rigid/local rig_hex_1 omegax omegay omegaz      # RB1 angular velocities
compute av_2    all rigid/local rig_hex_2 omegax omegay omegaz      # RB2 angular velocities
compute am_1    all rigid/local rig_hex_1 angmomx angmomy angmomz   # RB1 angular momenta
compute am_2    all rigid/local rig_hex_2 angmomx angmomy angmomz   # RB2 angular momenta
compute i_1    all rigid/local rig_hex_1 inertiax inertiay inertiaz # RB1 inertia
compute i_2    all rigid/local rig_hex_2 inertiax inertiay inertiaz # RB2 inertia

# ----------------------------- CONFIGURE OUTPUTS -------------------------------
thermo_style custom step f_hex_spring[*] temp pe ke etotal
dump    1 all custom ${log_freq} ${traj}       id type x y z
dump    1 all custom 10000 ${traj}       id type x y z
dump    1 all custom 10000 ${name}-traj.dump       id type x y z
dump    2 all local  ${log_freq} ${rb_info}  c_com_1[*] c_com_2[*]     c_vel_1[*] c_vel_2[*] c_q_1[*] c_q_2[*] c_av_1[*] c_av_2[*]        c_am_1[*] c_am_2[*] c_i_1[*] c_i_2[*]
dump    2 all local  10000 ${rb_info}  c_com_1[*] c_com_2[*]     c_vel_1[*] c_vel_2[*] c_q_1[*] c_q_2[*] c_av_1[*] c_av_2[*]        c_am_1[*] c_am_2[*] c_i_1[*] c_i_2[*]
dump    2 all local  10000 ${name}-info.dat  c_com_1[*] c_com_2[*]     c_vel_1[*] c_vel_2[*] c_q_1[*] c_q_2[*] c_av_1[*] c_av_2[*]        c_am_1[*] c_am_2[*] c_i_1[*] c_i_2[*]

log ${sim_log} # create new log file with simulation information only
log ${name}-sim.log 
