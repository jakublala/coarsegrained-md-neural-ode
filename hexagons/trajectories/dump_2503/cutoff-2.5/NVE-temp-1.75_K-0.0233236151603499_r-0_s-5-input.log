
# Simulation Parameters
variable log_freq equal 10000                   # log frequency
variable runsteps equal 100000000               # N of steps to run for
variable timestep equal 0.00001                 # timestep

# -------------------------- ATOMS/MOLECULE DEFINITION --------------------------
read_data hex.conf                              # Add a hexagon molecule
  orthogonal box = (-25 -25 -25) to (25 25 25)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  7 atoms
  scanning bonds ...
  6 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  12 bonds
  reading angles ...
  11 angles
  6 = max # of 1-2 neighbors
  12 = max # of 1-3 neighbors
  36 = max # of 1-4 neighbors
  6 = max # of special neighbors
  special bonds CPU = 0.0008233 secs
  read_data CPU = 0.0103123 secs
read_data hex.conf add append shift 4.0 0.0 0.0 # Add a second identical molecule, shifted so it doesn't overlap
  orthogonal box = (-25 -25 -25) to (29 25 25)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  7 atoms
  scanning bonds ...
  6 = max bonds/atom
  scanning angles ...
  6 = max angles/atom
  reading bonds ...
  12 bonds
  reading angles ...
  11 angles
  6 = max # of 1-2 neighbors
  12 = max # of 1-3 neighbors
  36 = max # of 1-4 neighbors
  6 = max # of special neighbors
  special bonds CPU = 0.0009455 secs
  read_data CPU = 0.001946 secs

# Group ID can be used in other commands, including fix, compute, dump or velocity
group       hex_1 id 1 2 3 4 5 6 7              # label the atoms 1-7 as a group
7 atoms in group hex_1
group       hex_2 id 8 9 10 11 12 13 14         # label the atoms 8-14 as another group
7 atoms in group hex_2

# -------------------------- INTERATOMIC POTENTIALS -----------------------------
# Pairwise potentials
pair_style  lj/cut  ${cut}                      # lj truncated - cutoff at 1.12 sigma
pair_style  lj/cut  2.5                      
pair_coeff  *   *   1.0 ${sigma}                # epsilon | sigma - * * means all atoms interact with each other
pair_coeff  *   *   1.0 1                
fix hex_spring_NVT hex_1 spring couple hex_2 1.0 0.0 0.0 0.0 ${r0} # adds harmonic spring between rigid bodies
fix hex_spring_NVT hex_1 spring couple hex_2 1.0 0.0 0.0 0.0 0 
                            # f_hex_spring[1,2,3,4] = force_x, force_y, force_z, magnitude of the force


################## SYSTEM INITIALISATION WITH AN NVT SIMULATION ##################
# -------------------------------------------------------------------------------
# Add energy to the system by running an NVT simulation, use a very stiff spring to
# keep rigid bodies close. Then, remove (unfix) the thermostat and spring before
# initialising and running the more important NVE simulation
# -------------------------------------------------------------------------------

# System fixes: spring and nose-hoover thermostat
fix hex_spring_NVT hex_1 spring couple hex_2 1 0 0 0 ${r0} # adds harmonic spring between RBs
fix hex_spring_NVT hex_1 spring couple hex_2 1 0 0 0 0 
fix rigid_1_NVT hex_1 rigid/nvt/small molecule temp ${temp} ${temp} 1.0 tparam 10 3 3
fix rigid_1_NVT hex_1 rigid/nvt/small molecule temp 1.75 ${temp} 1.0 tparam 10 3 3
fix rigid_1_NVT hex_1 rigid/nvt/small molecule temp 1.75 1.75 1.0 tparam 10 3 3
  create bodies CPU = 1.26e-05 secs
1 rigid bodies with 7 atoms
  1 = max distance from body owner to body atom
fix rigid_2_NVT hex_2 rigid/nvt/small molecule temp ${temp} ${temp} 1.0 tparam 10 3 3
fix rigid_2_NVT hex_2 rigid/nvt/small molecule temp 1.75 ${temp} 1.0 tparam 10 3 3
fix rigid_2_NVT hex_2 rigid/nvt/small molecule temp 1.75 1.75 1.0 tparam 10 3 3
  create bodies CPU = 9.2e-06 secs
1 rigid bodies with 7 atoms
  1 = max distance from body owner to body atom

# Basic output to terminal
thermo ${log_freq}
thermo 10000
thermo_style custom step f_hex_spring_NVT[*] temp pe ke etotal

# Set temperature and run simulation
velocity hex_1 create ${temp} ${seed}
velocity hex_1 create 1.75 ${seed}
velocity hex_1 create 1.75 5
WARNING: Changing velocities of atoms in rigid bodies. This has no effect unless rigid bodies are rebuild (src/velocity.cpp:71)
WARNING: Cannot count rigid body degrees-of-freedom before bodies are fully initialized (src/RIGID/fix_rigid_small.cpp:1157)
WARNING: Cannot count rigid body degrees-of-freedom before bodies are fully initialized (src/RIGID/fix_rigid_small.cpp:1157)
run 0
WARNING: Bonds are defined but no bond style is set (src/force.cpp:205)
WARNING: Likewise 1-2 special neighbor interactions != 1.0 (src/force.cpp:207)
WARNING: Angles are defined but no angle style is set (src/force.cpp:210)
WARNING: Likewise 1-3 special neighbor interactions != 1.0 (src/force.cpp:212)
WARNING: More than one fix rigid (src/RIGID/fix_rigid_small.cpp:561)
WARNING: More than one fix rigid (src/RIGID/fix_rigid_small.cpp:561)
Neighbor list info ...
  update every 1 steps, delay 10 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 2.8
  ghost atom cutoff = 2.8
  binsize = 1.4, bins = 39 36 36
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair lj/cut, perpetual
      attributes: half, newton on
      pair build: half/bin/newton
      stencil: half/bin/3d/newton
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 17.88 | 17.88 | 17.88 Mbytes
Step f_hex_spring_NVT[1] f_hex_spring_NVT[2] f_hex_spring_NVT[3] f_hex_spring_NVT[4] Temp PotEng KinEng TotEng 
       0   0.28571429            0            0   0.28571429  0.040968903 -0.0043945312  0.013168576 0.0087740446 
Loop time of 1.6e-06 on 1 procs for 0 steps with 14 atoms

187.5% CPU use with 1 MPI tasks x no OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0          | 0          | 0          |   0.0 |  0.00
Bond    | 0          | 0          | 0          |   0.0 |  0.00
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0          | 0          | 0          |   0.0 |  0.00
Output  | 0          | 0          | 0          |   0.0 |  0.00
Modify  | 0          | 0          | 0          |   0.0 |  0.00
Other   |            | 1.6e-06    |            |       |100.00

Nlocal:    14 ave 14 max 14 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:    0 ave 0 max 0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    5 ave 5 max 5 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 5
Ave neighs/atom = 0.357143
Ave special neighs/atom = 6
Neighbor list builds = 0
Dangerous builds = 0
velocity all scale ${temp}
velocity all scale 1.75
WARNING: Changing velocities of atoms in rigid bodies. This has no effect unless rigid bodies are rebuild (src/velocity.cpp:71)
run 100000
WARNING: Bonds are defined but no bond style is set (src/force.cpp:205)
WARNING: Likewise 1-2 special neighbor interactions != 1.0 (src/force.cpp:207)
WARNING: Angles are defined but no angle style is set (src/force.cpp:210)
WARNING: Likewise 1-3 special neighbor interactions != 1.0 (src/force.cpp:212)
WARNING: More than one fix rigid (src/RIGID/fix_rigid_small.cpp:561)
WARNING: More than one fix rigid (src/RIGID/fix_rigid_small.cpp:561)
Per MPI rank memory allocation (min/avg/max) = 17.88 | 17.88 | 17.88 Mbytes
Step f_hex_spring_NVT[1] f_hex_spring_NVT[2] f_hex_spring_NVT[3] f_hex_spring_NVT[4] Temp PotEng KinEng TotEng 
       0   0.28571429            0            0   0.28571429         1.75 -0.0043945312       0.5625   0.55810547 
   10000  -0.05006367  -0.22637089   0.03380526   0.23429244    1.4641725 -0.0098989203   0.47062686   0.46072794 
   20000 0.0030203038  0.057862418  -0.25286544    0.2594188    1.1588072 -0.0094257616   0.37247374   0.36304797 
   30000 -0.034400673 -0.043797343 -0.052464593  0.076512398    1.9667014   -1.2035313   0.63215402  -0.57137726 
   40000  0.081601156 -0.0094753472  -0.11675324   0.14275801    3.9865279  -0.31065387     1.281384   0.97073011 
   50000 -0.049357991  0.048820357  0.030487451  0.075822972    1.2994726   -1.1878267   0.41768761  -0.77013911 
   60000 -0.025916137  0.052614868  0.071909647  0.092795301    2.6277793   -1.0892176   0.84464334  -0.24457422 
   70000 -0.0037938087  -0.21264612  0.007656026   0.21281772    1.7247245  -0.10704177   0.55437574   0.44733397 
   80000  0.047514296  -0.03992861 -0.066354582   0.09085611    1.7626116   -1.0966536   0.56655373  -0.53009986 
   90000  -0.10174512 -0.063659742 -0.040659488   0.12671948    2.7622717  -0.50299182   0.88787304   0.38488122 
  100000 -0.023660788  -0.10765566 -0.019640839   0.11196132    2.6201085  -0.86424693   0.84217773 -0.022069197 
Loop time of 1.57309 on 1 procs for 100000 steps with 14 atoms

Performance: 27461909.315 tau/day, 63569.235 timesteps/s
92.4% CPU use with 1 MPI tasks x no OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.088542   | 0.088542   | 0.088542   |   0.0 |  5.63
Bond    | 0.039671   | 0.039671   | 0.039671   |   0.0 |  2.52
Neigh   | 0.26378    | 0.26378    | 0.26378    |   0.0 | 16.77
Comm    | 0.09443    | 0.09443    | 0.09443    |   0.0 |  6.00
Output  | 0.0004317  | 0.0004317  | 0.0004317  |   0.0 |  0.03
Modify  | 0.95333    | 0.95333    | 0.95333    |   0.0 | 60.60
Other   |            | 0.1329     |            |       |  8.45

Nlocal:    14 ave 14 max 14 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:    0 ave 0 max 0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    44 ave 44 max 44 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 44
Ave neighs/atom = 3.14286
Ave special neighs/atom = 6
Neighbor list builds = 6193
Dangerous builds = 261

unfix rigid_1_NVT
unfix rigid_2_NVT
unfix hex_spring_NVT

################################ NVE SIMULATION #################################
# ------------------------------- SYSTEM FIXES ----------------------------------
fix rig_hex_1 hex_1 rigid/nve/small molecule
  create bodies CPU = 9e-06 secs
1 rigid bodies with 7 atoms
  1 = max distance from body owner to body atom
fix rig_hex_2 hex_2 rigid/nve/small molecule
  create bodies CPU = 5.8e-06 secs
1 rigid bodies with 7 atoms
  1 = max distance from body owner to body atom
fix hex_spring hex_1 spring couple hex_2 ${K} 0.0 0.0 0.0 ${r0} # spring between RBs
fix hex_spring hex_1 spring couple hex_2 0.0233236151603499 0.0 0.0 0.0 ${r0} 
fix hex_spring hex_1 spring couple hex_2 0.0233236151603499 0.0 0.0 0.0 0 
# f_hex_spring[1,2,3,4] = force_x, force_y, force_z, magnitude of the force

# ----------------------------- PROPERTY COMPUTES -------------------------------
# Calculate rigid body properties - local data, so must be outputted using dump ... "local"
compute com_1   all rigid/local rig_hex_1 xu yu zu                  # RB1 unscaled center of mass x, y, z
compute com_2   all rigid/local rig_hex_2 xu yu zu                  # RB2 unscaled center of mass x, y, z
compute vel_1   all rigid/local rig_hex_1 vx vy vz                  # RB1 center of mass velocities vx, vy, vz
compute vel_2   all rigid/local rig_hex_2 vx vy vz                  # RB2 center of mass velocities vx, vy, vz
compute q_1     all rigid/local rig_hex_1 quati quatj quatk quatw   # RB1 quaternion components
compute q_2     all rigid/local rig_hex_2 quati quatj quatk quatw   # RB2 quaternion components
compute av_1    all rigid/local rig_hex_1 omegax omegay omegaz      # RB1 angular velocities
compute av_2    all rigid/local rig_hex_2 omegax omegay omegaz      # RB2 angular velocities
compute am_1    all rigid/local rig_hex_1 angmomx angmomy angmomz   # RB1 angular momenta
compute am_2    all rigid/local rig_hex_2 angmomx angmomy angmomz   # RB2 angular momenta
compute i_1    all rigid/local rig_hex_1 inertiax inertiay inertiaz # RB1 inertia
compute i_2    all rigid/local rig_hex_2 inertiax inertiay inertiaz # RB2 inertia

# ----------------------------- CONFIGURE OUTPUTS -------------------------------
thermo_style custom step f_hex_spring[*] temp pe ke etotal
dump    1 all custom ${log_freq} ${traj}       id type x y z
dump    1 all custom 10000 ${traj}       id type x y z
dump    1 all custom 10000 NVE-temp-1.75_K-0.0233236151603499_r-0_s-5-traj.dump       id type x y z
dump    2 all local  ${log_freq} ${rb_info}  c_com_1[*] c_com_2[*]     c_vel_1[*] c_vel_2[*] c_q_1[*] c_q_2[*] c_av_1[*] c_av_2[*]        c_am_1[*] c_am_2[*] c_i_1[*] c_i_2[*]
dump    2 all local  10000 ${rb_info}  c_com_1[*] c_com_2[*]     c_vel_1[*] c_vel_2[*] c_q_1[*] c_q_2[*] c_av_1[*] c_av_2[*]        c_am_1[*] c_am_2[*] c_i_1[*] c_i_2[*]
dump    2 all local  10000 NVE-temp-1.75_K-0.0233236151603499_r-0_s-5-info.dat  c_com_1[*] c_com_2[*]     c_vel_1[*] c_vel_2[*] c_q_1[*] c_q_2[*] c_av_1[*] c_av_2[*]        c_am_1[*] c_am_2[*] c_i_1[*] c_i_2[*]

log ${sim_log} # create new log file with simulation information only
log NVE-temp-1.75_K-0.0233236151603499_r-0_s-5-sim.log 
